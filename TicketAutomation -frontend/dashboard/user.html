<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Ticket Automation System</title>

    <link
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
        rel="stylesheet"
    >

    <style>
        /* Compact filter bar */
        .filter-bar {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 10px 12px;
        }

        .filter-bar select,
        .filter-bar input {
            font-size: 0.9rem;
            height: 36px;
        }

        .filter-bar .btn {
            height: 36px;
            padding: 0 14px;
        }
    </style>
</head>

<body onload="checkAuth(); loadUserTickets();">

<!-- NAVBAR -->
<nav class="navbar navbar-dark bg-dark px-4">
    <span class="navbar-brand">Ticket Automation System</span>
    <button class="btn btn-danger" onclick="logout()">Logout</button>
</nav>

<div class="container mt-4">

    <!-- USER INFO -->
    <h5 id="userInfo" class="mb-3"></h5>

    <!-- ACTION PANEL -->
    <div class="btn-group mb-3">
        <button class="btn btn-primary" onclick="loadUserTickets()">My Tickets</button>
        <button class="btn btn-outline-primary" onclick="showSection('createTicketSection')">
            Create Ticket
        </button>
    </div>

    <!-- SEARCH + FILTER BAR -->
    <div id="searchFilterSection" class="filter-bar mb-3">
        <div class="row g-2 align-items-center">

            <!-- SEARCH -->
            <div class="col-md-5">
                <div class="input-group input-group-sm">
                    <input
                        id="searchTicketId"
                        class="form-control"
                        placeholder="Search by Ticket ID"
                    >
                    <button class="btn btn-primary" onclick="searchTicketById()">Search</button>
                    <button class="btn btn-outline-secondary" onclick="resetFilters()">Reset</button>
                </div>
            </div>

            <!-- FILTERS -->
            <div class="col-md-7">
                <div class="d-flex gap-2">
                    <select id="filterStatus" class="form-select form-select-sm">
                        <option value="">Status</option>
                        <option>OPEN</option>
                        <option>IN_PROGRESS</option>
                        <option>WAITING_FOR_CUSTOMER</option>
                        <option>RESOLVED</option>
                        <option>CLOSED</option>
                    </select>

                    <select id="filterCategory" class="form-select form-select-sm">
                        <option value="">Category</option>
                        <option>BILLING</option>
                        <option>TECHNICAL</option>
                        <option>ACCOUNT</option>
                        <option>SECURITY</option>
                        <option>OTHER</option>
                    </select>

                    <select id="filterPriority" class="form-select form-select-sm">
                        <option value="">Priority</option>
                        <option>LOW</option>
                        <option>MEDIUM</option>
                        <option>HIGH</option>
                        <option>CRITICAL</option>
                    </select>

                    <button
                        class="btn btn-outline-primary btn-sm"
                        onclick="applyFilters()"
                    >
                        Apply
                    </button>
                </div>
            </div>

        </div>
    </div>

    <!-- TICKET LIST -->
    <div id="ticketListSection">
        <div id="ticketList"></div>
    </div>

    <!-- TICKET DETAILS -->
    <div id="ticketDetailSection" style="display:none;">
        <button class="btn btn-link mb-3" onclick="loadUserTickets()">‚Üê Back</button>

        <div class="card shadow-sm mb-3">
            <div class="card-body" id="detailContent"></div>
        </div>

        <div class="card shadow-sm mb-3">
            <div class="card-body">
                <h6>AI Analysis</h6>
                <p id="aiSummary" class="text-muted">Loading...</p>
            </div>
        </div>

    </div>

    <!-- CREATE TICKET -->
    <div id="createTicketSection" style="display:none;">
        <div class="card shadow-sm">
            <div class="card-body">
                <h6>Create Ticket</h6>

                <form id="createTicketForm">
                    <input id="title" class="form-control mb-2" placeholder="Ticket Title">

                    <textarea
                        id="description"
                        class="form-control mb-2"
                        placeholder="Description"
                    ></textarea>

                    <select id="category" class="form-control mb-3">
                        <option>BILLING</option>
                        <option>TECHNICAL</option>
                        <option>ACCOUNT</option>
                        <option>SECURITY</option>
                        <option>OTHER</option>
                    </select>

                    <button
                        type="button"
                        class="btn btn-success"
                        onclick="createTicket()"
                    >
                        Submit
                    </button>
                </form>

                <div id="createTicketMsg" class="mt-3"></div>
            </div>
        </div>
    </div>

</div>

<!-- MESSAGE MODAL -->
<div class="modal fade" id="messageModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">

            <div class="modal-header">
                <h5 class="modal-title">Conversation</h5>
                <button type="button" class="btn-close" onclick="closeMessageModal()"></button>
            </div>

            <!-- UPDATED BODY -->
            <div class="modal-body">
                <div
                    id="chatMessages"
                    style="height:350px; overflow-y:auto; background:#f8f9fa; padding:10px; border-radius:6px;">
                </div>
            </div>

            <!-- UPDATED FOOTER -->
            <div class="modal-footer d-flex">
                <input
                    id="chatInput"
                    class="form-control me-2"
                    placeholder="Type your message..."
                >
                <button id="sendBtn" class="btn btn-primary" onclick="sendMessage()">
                  Send
                </button>

                    
                
            </div>

        </div>
    </div>
</div>

<script src="../js/auth.js"></script>
<script src="../js/dashboard.js"></script>
<script src="../js/ticket.js"></script>
<script src="../js/message.js"></script>

</body>
</html>
